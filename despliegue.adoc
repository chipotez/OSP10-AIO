= OSP 10 - All in one
Miguel Pineda <mpinedam@redhat.com>
v1.0, 2017-12-19
:doctype: book
:keywords: Asciidoctor, samples, e-book, EPUB3, KF8, MOBI, Asciidoctor.js


////
*Comment* 
S10 ctr01    - f2lctr01.act.com.mx        10.10.205.23 10.17.32.10 
S11 ctr02    - f2lctr02.act.com.mx        10.10.205.24 10.17.32.11
S9 compute01 - f2lcompute01.act.com.mx    10.10.205.19 10.17.32.12
S7 compute02 - f2lcompute02.act.com.mx    10.10.205.20 10.17.32.13
S6 compute03 - f2lcompute03.act.com.mx    10.10.205.21 10.17.32.14
V1             v1plsatellite01.act.com.mx 10.10.110.21
V2             v2plntpserver01.act.com.mx 10.10.113.50
Actinver01
////

== 1 .- Resumen de Laboratorio

Con la finalidad de proveer de una plataforma de funcionalidades IaaS, Red Hat apoya a
Grupo Financiero Actinver implementando los siguientes componentes en un
ambiente de laboratorio :

* Red Hat Openstack Platform v10+u con Packstack.

Dicho laboratorio esta diseñado para acercar lo mas posible la funcionalidad actual a un
ambiente de Desarrollo ó Pruebas.

El laboratorio consta de una implementación estándar por lo cual no se realizó ninguna tarea
adicional (tunning) a ninguno de los componentes, no se contemplaron tareas de
benckmarking, por lo cual sí el cliente requiere obtener métricas de consumo, performance o
sizing, se tendrán que realizar tareas en una definición externa a este documento.

IMPORTANT: Este laboratorio se realizó con Packstack debido a que durante la instalación con
                       OSP Director las interfaces de red de los servidores IBM x240 8737AC1 durante el
                       proceso introspección no realizaban el proceso adecuado de descarga de imagenes,
                       Actualmente se tiene un ticket abierto con Red Hat sin embargo todo apunta a un 
                       problema de HW.


=== Componentes del entorno de laboratorio

* Una estación de trabajo cliente.
* Dos nodos control
* Tres nodos de computo

==== Designaciones de nodos

Los comandos se deben ejecutar en nodos específicos. Cada paso menciona el nodo o los nodos en los que se debe ejecutar entre corchetes, de la siguiente manera:

* [Control]
* [Computo]

Por ejemplo:

Ejecute este comando en los nodos *Control* y en el nodo *Computo*:

*[Control01-02]* *[Computo01-03]*

----
# yum install ntp
----

.Segmentación de equipos
[options="header,footer"]
|=======================
| Server No.  | Hostname       |Rol        |Ip MGNT      |Ip Publica / mask /gw/dns  | interfaz
|S6  | ctr01.example.com       |Controller |10.10.205.19 |10.12.8.11/24/10.12.8.254/10.11.9.250 |4 y 5
|S7  | ctr02.example.com       |Controller |10.10.205.20 |10.12.8.12/24/10.12.8.254/10.11.9.250 |4 y 5
|S9  | compute01.example.com   |Compute    |10.10.205.21 |10.12.8.13/24/10.12.8.254/10.11.9.250 |4 y 5
|S11 | compute02.example.com   |Compute    |10.10.205.23 |10.12.8.14/24/10.12.8.254/10.11.9.250 |4 y 5 
|S12 | compute03.example.com   |Compute    |10.10.205.24 |10.12.8.15/24/10.12.8.254/10.11.9.250 |4 y 5 
|    | satellite01.example.com |Satellite  |10.10.110.21 |    N/A
|    | ntp.example.com.        |NTP        |10.10.113.50 |
|=======================

== 2 .- Preparando Ambiente de Laboratorio.

=== 1.- Validando canales/repositorios necesarios.
En los nodos de Control, Computo, valide que tiene los repositorios necesarios para la instalación:

*[Control01-02]* *[Computo01-03]*

----
# yum repolist
----

* Salida Esperada:
+
[source,bash]
-----------------

Complementos cargados:enabled_repos_upload, package_upload, product-id, search-disabled-repos,
                    : subscription-manager
nombre del repositorio                                  estado
rhel-7-server-extras-rpms/x86_64                        RH Enterprise Linux 7 Server     710
rhel-7-server-openstack-10-devtools-rpms/7Server/x86_64 RH OpenStack Platform 10 Deve      8
rhel-7-server-openstack-10-optools-rpms/7Server/x86_64  RH OpenStack Platform 10 Oper     99
rhel-7-server-openstack-10-rpms/7Server/x86_64          RH OpenStack Platform 10 for   1 711
rhel-7-server-rh-common-rpms/7Server/x86_64             RH Enterprise Linux 7 Server     231
rhel-7-server-rpms/7Server/x86_64                       RH Enterprise Linux 7 Server  17 802
rhel-7-server-satellite-tools-6.2-rpms/x86_64           RH Satellite Tools 6.2 (for R    132
rhel-ha-for-rhel-7-server-rpms/7Server/x86_64           RH Enterprise Linux High Avai    391
repolist: 21 084
Uploading Enabled Repositories Report
Complementos cargados:product-id, subscription-manager


-----------------


TIP: Red Hat actualiza periódicamente sus repositorios, por lo que la cantidad de paquetes puede variar de los que se muestran arriba. 
     Lo mismo para versiones de productos menores o superiores.
     
=== 2.- Actualizar nodos:

Antes de comenzar los laboratorios restantes, asegúrese de que sus paquetes estén actualizados.

a)  Actualize los paquetes en todos los nodos

*[Control01-02]* *[Computo01-03]*

----
# yum -y update
----

* Salida Esperada:
+
[source,bash]
-----------------
[root@f2lctr01 ~]# yum -y update
Complementos cargados:enabled_repos_upload, package_upload, product-id, search-disabled-repos,
                    : subscription-manager
rhel-7-server-openstack-10-devtools-rpms                                  | 2.3 kB  00:00:00     
rhel-7-server-openstack-10-optools-rpms                                   | 2.3 kB  00:00:00     
Resolviendo dependencias
--> Ejecutando prueba de transacción                                                                                                                                                                                                                                         
---> Paquete pyOpenSSL.x86_64 0:0.13.1-3.el7 debe ser obsoleto
---> Paquete python-dateutil.noarch 0:1.5-7.el7 debe ser actualizado
---> Paquete python-dateutil.noarch 1:2.4.2-1.el7ost debe ser una actualización
--> Procesando dependencias: python-six para el paquete: 1:python-dateutil-2.4.2-1.el7ost.noarch
---> Paquete python-lxml.x86_64 0:3.2.1-4.el7 debe ser actualizado
---> Paquete python-lxml.x86_64 0:3.2.1-5.el7ost debe ser una actualización
---> Paquete python-pyOpenSSL.noarch 0:16.2.0-3.el7ost debe ser obsoleto
--> Procesando dependencias: python-cryptography >= 1.3.0 para el paquete: python-pyOpenSSL-16.2.0-3.el7ost.noarch
--> Ejecutando prueba de transacción                                                                                                                                                                                                                                         
---> Paquete python-six.noarch 0:1.9.0-2.el7 debe ser instalado
---> Paquete python2-cryptography.x86_64 0:1.7.2-1.el7_4.1 debe ser instalado
--> Procesando dependencias: python-pyasn1 >= 0.1.8 para el paquete: python2-cryptography-1.7.2-1.el7_4.1.x86_64
--> Procesando dependencias: python-idna >= 2.0 para el paquete: python2-cryptography-1.7.2-1.el7_4.1.x86_64
--> Procesando dependencias: python-cffi >= 1.4.1 para el paquete: python2-cryptography-1.7.2-1.el7_4.1.x86_64
--> Procesando dependencias: python-ipaddress para el paquete: python2-cryptography-1.7.2-1.el7_4.1.x86_64
--> Procesando dependencias: python-enum34 para el paquete: python2-cryptography-1.7.2-1.el7_4.1.x86_64
--> Ejecutando prueba de transacción                                                                                                                                                                                                                                         
---> Paquete python-cffi.x86_64 0:1.6.0-5.el7 debe ser instalado
--> Procesando dependencias: python-pycparser para el paquete: python-cffi-1.6.0-5.el7.x86_64
---> Paquete python-enum34.noarch 0:1.0.4-1.el7 debe ser instalado
---> Paquete python-idna.noarch 0:2.4-1.el7 debe ser instalado
---> Paquete python-ipaddress.noarch 0:1.0.16-2.el7 debe ser instalado
---> Paquete python2-pyasn1.noarch 0:0.1.9-7.el7 debe ser instalado
--> Ejecutando prueba de transacción                                                                                                                                                                                                                                         
---> Paquete python-pycparser.noarch 0:2.14-1.el7 debe ser instalado
--> Procesando dependencias: python-ply para el paquete: python-pycparser-2.14-1.el7.noarch
--> Ejecutando prueba de transacción                                                                                                                                                                                                                                         
---> Paquete python-ply.noarch 0:3.4-11.el7 debe ser instalado
--> Resolución de dependencias finalizada                                                                                                                                                                                        

Dependencias resueltas

 python-pyOpenSSL        noarch    16.2.0-3.el7ost      rhel-7-server-openstack-10-rpms     88 k
     reemplazando  pyOpenSSL.x86_64 0.13.1-3.el7
Actualizando:
 python-dateutil         noarch    1:2.4.2-1.el7ost     rhel-7-server-openstack-10-rpms     84 k
 python-lxml             x86_64    3.2.1-5.el7ost       rhel-7-server-openstack-10-rpms    847 k
Instalando para las dependencias:
 python-cffi             x86_64    1.6.0-5.el7          rhel-7-server-rpms                 218 k
 python-enum34           noarch    1.0.4-1.el7          rhel-7-server-rpms                  52 k
 python-idna             noarch    2.4-1.el7            rhel-7-server-rpms                  94 k
 python-ipaddress        noarch    1.0.16-2.el7         rhel-7-server-rpms                  34 k
 python-ply              noarch    3.4-11.el7           rhel-7-server-rpms                 123 k
 python-pycparser        noarch    2.14-1.el7           rhel-7-server-rpms                 105 k
 python-six              noarch    1.9.0-2.el7          rhel-7-server-rpms                  29 k
 python2-cryptography    x86_64    1.7.2-1.el7_4.1      rhel-7-server-rpms                 502 k
 python2-pyasn1          noarch    0.1.9-7.el7          rhel-7-server-rpms                 100 k

Resumen de la transacción                                                                                                                                                                                                                              
=================================================================================================
Instalar    1 Paquete  (+9 Paquetes dependientes)
Actualizar  2 Paquetes

Tamaño total de la descarga: 2.2 M
Downloading packages:
Delta RPMs disabled because /usr/bin/applydeltarpm not installed.
(1/12): python-dateutil-2.4.2-1.el7ost.noarch.rpm                         |  84 kB  00:00:00     
(2/12): python-cffi-1.6.0-5.el7.x86_64.rpm                                | 218 kB  00:00:00     
(3/12): python-enum34-1.0.4-1.el7.noarch.rpm                              |  52 kB  00:00:00     
(4/12): python-ipaddress-1.0.16-2.el7.noarch.rpm                          |  34 kB  00:00:00     
(5/12): python-idna-2.4-1.el7.noarch.rpm                                  |  94 kB  00:00:00     
(6/12): python-ply-3.4-11.el7.noarch.rpm                                  | 123 kB  00:00:00     
(7/12): python-pycparser-2.14-1.el7.noarch.rpm                            | 105 kB  00:00:00     
(8/12): python-six-1.9.0-2.el7.noarch.rpm                                 |  29 kB  00:00:00     
(9/12): python-lxml-3.2.1-5.el7ost.x86_64.rpm                             | 847 kB  00:00:00     
(10/12): python-pyOpenSSL-16.2.0-3.el7ost.noarch.rpm                      |  88 kB  00:00:00     
(11/12): python2-cryptography-1.7.2-1.el7_4.1.x86_64.rpm                  | 502 kB  00:00:00     
(12/12): python2-pyasn1-0.1.9-7.el7.noarch.rpm                            | 100 kB  00:00:00     
-------------------------------------------------------------------------------------------------
Total                                                            4.8 MB/s | 2.2 MB  00:00:00     
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Instalando    : python-six-1.9.0-2.el7.noarch                                             1/15 
  Instalando    : python2-pyasn1-0.1.9-7.el7.noarch                                         2/15 
  Instalando    : python-enum34-1.0.4-1.el7.noarch                                          3/15 
  Instalando    : python-ipaddress-1.0.16-2.el7.noarch                                      4/15 
  Instalando    : python-ply-3.4-11.el7.noarch                                              5/15 
  Instalando    : python-pycparser-2.14-1.el7.noarch                                        6/15 
  Instalando    : python-cffi-1.6.0-5.el7.x86_64                                            7/15 
  Instalando    : python-idna-2.4-1.el7.noarch                                              8/15 
  Instalando    : python2-cryptography-1.7.2-1.el7_4.1.x86_64                               9/15 
  Instalando    : python-pyOpenSSL-16.2.0-3.el7ost.noarch                                  10/15 
  Actualizando  : 1:python-dateutil-2.4.2-1.el7ost.noarch                                  11/15 
  Actualizando  : python-lxml-3.2.1-5.el7ost.x86_64                                        12/15 
  Limpieza      : python-dateutil-1.5-7.el7.noarch                                         13/15 
  Eliminando    : pyOpenSSL-0.13.1-3.el7.x86_64                                            14/15 
  Limpieza      : python-lxml-3.2.1-4.el7.x86_64                                           15/15 
Uploading Package Profile
rhel-7-server-openstack-10-devtools-rpms/7Server/x86_64/productid         | 2.1 kB  00:00:00     
rhel-7-server-openstack-10-optools-rpms/7Server/x86_64/productid          | 2.1 kB  00:00:00     
  Comprobando   : python-idna-2.4-1.el7.noarch                                              1/15 
  Comprobando   : python-pycparser-2.14-1.el7.noarch                                        2/15 
  Comprobando   : python-ply-3.4-11.el7.noarch                                              3/15 
  Comprobando   : python-pyOpenSSL-16.2.0-3.el7ost.noarch                                   4/15 
  Comprobando   : python-lxml-3.2.1-5.el7ost.x86_64                                         5/15 
  Comprobando   : python-cffi-1.6.0-5.el7.x86_64                                            6/15 
  Comprobando   : python-ipaddress-1.0.16-2.el7.noarch                                      7/15 
  Comprobando   : python-enum34-1.0.4-1.el7.noarch                                          8/15 
  Comprobando   : python2-pyasn1-0.1.9-7.el7.noarch                                         9/15 
  Comprobando   : python-six-1.9.0-2.el7.noarch                                            10/15 
  Comprobando   : python2-cryptography-1.7.2-1.el7_4.1.x86_64                              11/15 
  Comprobando   : 1:python-dateutil-2.4.2-1.el7ost.noarch                                  12/15 
  Comprobando   : pyOpenSSL-0.13.1-3.el7.x86_64                                            13/15 
  Comprobando   : python-dateutil-1.5-7.el7.noarch                                         14/15 
  Comprobando   : python-lxml-3.2.1-4.el7.x86_64                                           15/15 

Instalado:
  python-pyOpenSSL.noarch 0:16.2.0-3.el7ost                                                      

Dependencia(s) instalada(s):
  python-cffi.x86_64 0:1.6.0-5.el7           python-enum34.noarch 0:1.0.4-1.el7                  
  python-idna.noarch 0:2.4-1.el7             python-ipaddress.noarch 0:1.0.16-2.el7              
  python-ply.noarch 0:3.4-11.el7             python-pycparser.noarch 0:2.14-1.el7                
  python-six.noarch 0:1.9.0-2.el7            python2-cryptography.x86_64 0:1.7.2-1.el7_4.1       
  python2-pyasn1.noarch 0:0.1.9-7.el7       

Actualizado:
  python-dateutil.noarch 1:2.4.2-1.el7ost           python-lxml.x86_64 0:3.2.1-5.el7ost          

Sustituido(s):
  pyOpenSSL.x86_64 0:0.13.1-3.el7                                                                

¡Listo!
Uploading Enabled Repositories Report
Complementos cargados:product-id, subscription-manager
  

-----------------

b) En caso de tener una nueva versión de Kernel, reinicie los nodos:

----
# reboot
----

=== 3.- Instalar Utilerias de OpenStack.

OpenStack requiere unos pocos paquetes base y definiciones de políticas (SELinux) en todos los nodos.

a) Como *root*, ejecute el siguiente comando en todos los nodos:

*[Control01-02]* *[Computo01-03]*

----
# yum -y install openstack-utils openstack-selinux
----       
       
=== 4.- Configurando Firewall

a) Instale el paquete iptables-services en todos los nodos:

*[Control01-03]* *[Computo01-03]*

----
# yum -y install iptables-services
----

b) Iniciar y habilitar los servicios de iptables e ip6tables.

*[Control01-02]* *[Compute01-03]*

----
# systemctl start iptables.service ip6tables.service
# systemctl enable iptables.service ip6tables.service
----

=== 5.- Configurar NTP Server en nodo Controller.

a) Vea el archivo /etc/ntp.conf y asegúrese de que contiene las siguientes declaraciones del servidor:

*[Control01]*

* Salida Esperada:
+
[source,bash]
-----------------
server 10.10.113.50 iburst
-----------------
    
b) En la parte superior del archivo, comente las tres líneas de restricción para permitir el acceso y agregue lo siguiente:

*[Control01]*

----
restrict -4 default kod notrap nomodify
restrict -6 default kod notrap nomodify
----

c) Guarde y cierre el archivo

d) Inicie y habilite el servicio de NTP.

*[Control01]*

----
# systemctl enable ntpd.service
# systemctl start ntpd.service
----

e) abra el archivo /etc/sysconfig/iptables con un editor de textos.

f) Agregue una regla de entrada que permita el tráfico UDP en el puerto 123 para que el servidor NTP pueda responder las consultas que le realicen.

*[Control01]*

----
-A INPUT -p udp -m udp --dport 123 -j ACCEPT
----

g) Reinicie el servicio de iptables y verifique la configuración:

*[Control01]*

----
# systemctl restart iptables.service
# iptables -L
----

* Salida Esperada:
+
[source,bash]
-----------------
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
ACCEPT     icmp --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere
ACCEPT     tcp  --  anywhere             anywhere             state NEW tcp dpt:ssh
ACCEPT     udp  --  anywhere             anywhere             udp dpt:ntp
REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
REJECT     all  --  anywhere             anywhere             reject-with icmp-host-prohibited

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
-----------------

=== 6.- Configurando NTP en nodos Control y Compute.

a) En los nodos Compute y el nodo Almacenamiento, instale los paquetes NTP requeridos:

b) Edite el archivo /etc/ntp.conf para que la declaración del servidor apunte a su nodo Control.

*[Control02]* *[Computo01-03]*
----
server ctrl.example.com iburst
----

c) Guarde y Cierre el Archivo.

d) Inicie y habilite el servicio de NTP. 

*[Control02]* *[Computo01-03]*

----
# systemctl enable ntpd.service
# systemctl start ntpd.service
----

=== 7 Deshabilitando Network Manager

En esta sección, primero deshabilite Network Manager en su nodo Controller, Compute nodes. Luego habilite e inicie el servicio de *network* estándar.

a) Como usuario root, detenga y deshabilite el servicio de Network Manager:

*[Control01-02]* *[Computo01-03]*

----
# systemctl stop NetworkManager.service
# systemctl disable NetworkManager.service
----

b) Asegúrese de que el servicio *network* tome el control de las interfaces estableciendo la opción NM_CONTROLLED en "no":

*[Control01-02]* *[Computo01-03]*

----
echo 'NM_CONTROLLED="no"' | tee -a /etc/sysconfig/network-scripts/ifcfg-eth0

----

c) Reinicie los nodos.

*[Control01-02]* *[Computo01-03]*

----
# reboot
----

== 3 .- Laboratorio Packstack.




[root@f2lctr01 ~]# yum install openstack-packstackComplementos cargados:enabled_repos_upload, package_upload,
                    : product-id, search-disabled-repos,
                    : subscription-manager
rhel-7-server-extras-rpms                 | 2.0 kB     00:00     
rhel-7-server-openstack-10-devtools-rpms  | 2.3 kB     00:00     
rhel-7-server-openstack-10-optools-rpms   | 2.3 kB     00:00     
rhel-7-server-openstack-10-rpms           | 2.3 kB     00:00     
rhel-7-server-rh-common-rpms              | 2.1 kB     00:00     
rhel-7-server-rpms                        | 2.0 kB     00:00     
rhel-7-server-satellite-tools-6.2-rpms    | 2.1 kB     00:00     
rhel-ha-for-rhel-7-server-rpms            | 2.0 kB     00:00     
El paquete 1:openstack-packstack-9.0.3-4.el7ost.noarch ya se encuentra instalado con su versión más reciente
Nada para hacer
Uploading Enabled Repositories Report
Complementos cargados:product-id, subscription-manager
[root@f2lctr01 ~]# 




[root@f2lctr01 ~]# ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa): 
/root/.ssh/id_rsa already exists.
Overwrite (y/n)? y
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:M13MAJsIA3rWgQoKLkNERlKXb8LLQJB3aFrbWwkeP+k root@f2lctr01.actinver.com.mx
The key's randomart image is:
+---[RSA 2048]----+
|*Oo+=.  ...      |
|*oBo=+ . o +     |
|BBo*.=.oo   +    |
|*+o = O  . .     |
|.. o B .S .      |
|    + E  o       |
|                 |
|                 |
|                 |
+----[SHA256]-----+
[root@f2lctr01 ~]# packstack --gen-answer-file ~/answers.txt


[root@f2lctr01 ~]# packstack --answer-file ~/answers.txt
Welcome to the Packstack setup utility

The installation log file is available at: /var/tmp/packstack/20171220-111227-9tDkm_/openstack-setup.log

Installing:
Clean Up                                             [ DONE ]
Discovering ip protocol version                      [ DONE ]
Setting up ssh keys                                  [ DONE ]
Preparing servers                                    [ DONE ]
Pre installing Puppet and discovering hosts' details [ DONE ]
Preparing pre-install entries                        [ DONE ]
Installing time synchronization via NTP              [ DONE ]
Setting up CACERT                                    [ DONE ]
Preparing AMQP entries                               [ DONE ]
Preparing MariaDB entries                            [ DONE ]
Fixing Keystone LDAP config parameters to be undef if empty[ DONE ]
Preparing Keystone entries                           [ DONE ]
Preparing Glance entries                             [ DONE ]
Checking if the Cinder server has a cinder-volumes vg[ DONE ]
Preparing Cinder entries                             [ DONE ]
Preparing Nova API entries                           [ DONE ]
Creating ssh keys for Nova migration                 [ DONE ]
Gathering ssh host keys for Nova migration           [ DONE ]
Preparing Nova Compute entries                       [ DONE ]
Preparing Nova Scheduler entries                     [ DONE ]
Preparing Nova VNC Proxy entries                     [ DONE ]
Preparing OpenStack Network-related Nova entries     [ DONE ]
Preparing Nova Common entries                        [ DONE ]
Preparing Neutron LBaaS Agent entries                [ DONE ]
Preparing Neutron API entries                        [ DONE ]
Preparing Neutron L3 entries                         [ DONE ]
Preparing Neutron L2 Agent entries                   [ DONE ]
Preparing Neutron DHCP Agent entries                 [ DONE ]
Preparing Neutron Metering Agent entries             [ DONE ]
Checking if NetworkManager is enabled and running    [ DONE ]
Preparing OpenStack Client entries                   [ DONE ]
Preparing Horizon entries                            [ DONE ]
Preparing Swift builder entries                      [ DONE ]
Preparing Swift proxy entries                        [ DONE ]
Preparing Swift storage entries                      [ DONE ]
Preparing Heat entries                               [ DONE ]
Preparing Heat CloudWatch API entries                [ DONE ]
Preparing Heat CloudFormation API entries            [ DONE ]
Preparing Gnocchi entries                            [ DONE ]
Preparing MongoDB entries                            [ DONE ]
Preparing Redis entries                              [ DONE ]
Preparing Ceilometer entries                         [ DONE ]
Preparing Aodh entries                               [ DONE ]
Preparing Puppet manifests                           [ DONE ]
Copying Puppet modules and manifests                 [ DONE ]
Applying 10.12.8.11_controller.pp
10.12.8.11_controller.pp:                            [ DONE ]       
Applying 10.12.8.12_network.pp
Applying 10.12.8.11_network.pp
10.12.8.11_network.pp:                               [ DONE ]    
10.12.8.12_network.pp:                               [ DONE ]    
Applying 10.12.8.15_compute.pp
Applying 10.12.8.14_compute.pp
Applying 10.12.8.13_compute.pp
10.12.8.15_compute.pp:                               [ DONE ]    
10.12.8.13_compute.pp:                               [ DONE ]    
10.12.8.14_compute.pp:                               [ DONE ]    
Applying Puppet manifests                            [ DONE ]
Finalizing                                           [ DONE ]

 **** Installation completed successfully ******

Additional information:
 * File /root/keystonerc_admin has been created on OpenStack client host 10.12.8.11. To use the command line tools you need to source the file.
 * To access the OpenStack Dashboard browse to https://10.12.8.11/dashboard .
Please, find your login credentials stored in the keystonerc_admin in your home directory.
 * Because of the kernel update the host 10.12.8.15 requires reboot.
 * Because of the kernel update the host 10.12.8.14 requires reboot.
 * Because of the kernel update the host 10.12.8.12 requires reboot.
 * The installation log file is available at: /var/tmp/packstack/20171220-111227-9tDkm_/openstack-setup.log
 * The generated manifests are available at: /var/tmp/packstack/20171220-111227-9tDkm_/manifests





[root@f2lctr01 ~]# source keystonerc_admin 
[root@f2lctr01 ~(keystone_admin)]# cat keystonerc_admin 
unset OS_SERVICE_TOKEN
    export OS_USERNAME=admin
    export OS_PASSWORD=Actinver01
    export OS_AUTH_URL=http://10.12.8.11:5000/v2.0
    export PS1='[\u@\h \W(keystone_admin)]\$ '
    
export OS_TENANT_NAME=admin
export OS_REGION_NAME=RegionOne


[root@f2lctr01 ~(keystone_admin)]# openstack-service status
MainPID=8644 Id=neutron-dhcp-agent.service ActiveState=active
MainPID=8727 Id=neutron-l3-agent.service ActiveState=active
MainPID=8685 Id=neutron-lbaasv2-agent.service ActiveState=active
MainPID=8771 Id=neutron-metadata-agent.service ActiveState=active
MainPID=8605 Id=neutron-metering-agent.service ActiveState=active
MainPID=8565 Id=neutron-openvswitch-agent.service ActiveState=active
MainPID=6147 Id=neutron-server.service ActiveState=active
MainPID=28123 Id=openstack-aodh-evaluator.service ActiveState=active
MainPID=28040 Id=openstack-aodh-listener.service ActiveState=active
MainPID=28075 Id=openstack-aodh-notifier.service ActiveState=active
MainPID=29703 Id=openstack-ceilometer-central.service ActiveState=active
MainPID=29661 Id=openstack-ceilometer-collector.service ActiveState=active
MainPID=29622 Id=openstack-ceilometer-notification.service ActiveState=active
MainPID=29332 Id=openstack-cinder-api.service ActiveState=active
MainPID=29371 Id=openstack-cinder-backup.service ActiveState=active
MainPID=29447 Id=openstack-cinder-scheduler.service ActiveState=active
MainPID=29406 Id=openstack-cinder-volume.service ActiveState=active
MainPID=5697 Id=openstack-glance-api.service ActiveState=active
MainPID=5490 Id=openstack-glance-registry.service ActiveState=active
MainPID=28274 Id=openstack-gnocchi-metricd.service ActiveState=active
MainPID=28227 Id=openstack-gnocchi-statsd.service ActiveState=active
MainPID=6299 Id=openstack-heat-api-cfn.service ActiveState=active
MainPID=6420 Id=openstack-heat-api-cloudwatch.service ActiveState=active
MainPID=6373 Id=openstack-heat-api.service ActiveState=active
MainPID=6338 Id=openstack-heat-engine.service ActiveState=active
MainPID=0 Id=openstack-losetup.service ActiveState=active
MainPID=28923 Id=openstack-nova-api.service ActiveState=active
MainPID=28782 Id=openstack-nova-cert.service ActiveState=active
MainPID=29170 Id=openstack-nova-conductor.service ActiveState=active
MainPID=28874 Id=openstack-nova-consoleauth.service ActiveState=active
MainPID=28841 Id=openstack-nova-novncproxy.service ActiveState=active
MainPID=29114 Id=openstack-nova-scheduler.service ActiveState=active
MainPID=4223 Id=openstack-swift-account-auditor.service ActiveState=active
MainPID=3809 Id=openstack-swift-account-reaper.service ActiveState=active
MainPID=3853 Id=openstack-swift-account-replicator.service ActiveState=active
MainPID=3978 Id=openstack-swift-account.service ActiveState=active
MainPID=3896 Id=openstack-swift-container-auditor.service ActiveState=active
MainPID=3766 Id=openstack-swift-container-replicator.service ActiveState=active
MainPID=5987 Id=openstack-swift-container-updater.service ActiveState=active
MainPID=3939 Id=openstack-swift-container.service ActiveState=active
MainPID=4176 Id=openstack-swift-object-auditor.service ActiveState=active
MainPID=4127 Id=openstack-swift-object-expirer.service ActiveState=active
MainPID=4069 Id=openstack-swift-object-replicator.service ActiveState=active
MainPID=5736 Id=openstack-swift-object-updater.service ActiveState=active
MainPID=4023 Id=openstack-swift-object.service ActiveState=active
MainPID=5529 Id=openstack-swift-proxy.service ActiveState=active








[root@f2lctr01 ~(keystone_admin)]# nova hypervisor-list
+----+-----------------------------+-------+---------+
| ID | Hypervisor hostname         | State | Status  |
+----+-----------------------------+-------+---------+
| 1  | f2lcompute3.actinver.com.mx | up    | enabled |
| 2  | f2lcompute1.actinver.com.mx | up    | enabled |
| 3  | f2lcompute2.actinver.com.mx | up    | enabled |
+----+-----------------------------+-------+---------+




[root@f2lctr01 ~(keystone_admin)]# nova hypervisor-show f2lcompute1.actinver.com.mx
+---------------------------+------------------------------------------+
| Property                  | Value                                    |
+---------------------------+------------------------------------------+
| cpu_info_arch             | x86_64                                   |
| cpu_info_features         | ["pge", "avx", "xsaveopt", "clflush",    |
|                           | "sep", "syscall", "tsc-deadline",        |
|                           | "dtes64", "msr", "xsave", "vmx", "xtpr", |
|                           | "cmov", "pcid", "est", "pat", "monitor", |
|                           | "smx", "pbe", "lm", "tsc", "nx", "fxsr", |
|                           | "tm", "sse4.1", "pae", "sse4.2",         |
|                           | "pclmuldq", "acpi", "vme", "mmx",        |
|                           | "osxsave", "cx8", "mce", "de", "rdtscp", |
|                           | "ht", "dca", "lahf_lm", "pdcm", "mca",   |
|                           | "pdpe1gb", "apic", "sse", "pse", "ds",   |
|                           | "invtsc", "pni", "tm2", "aes", "sse2",   |
|                           | "ss", "ds_cpl", "arat", "ssse3", "fpu",  |
|                           | "cx16", "pse36", "mtrr", "popcnt",       |
|                           | "x2apic"]                                |
| cpu_info_model            | SandyBridge                              |
| cpu_info_topology_cells   | 2                                        |
| cpu_info_topology_cores   | 8                                        |
| cpu_info_topology_sockets | 1                                        |
| cpu_info_topology_threads | 2                                        |
| cpu_info_vendor           | Intel                                    |
| current_workload          | 0                                        |
| disk_available_least      | 47                                       |
| free_disk_gb              | 49                                       |
| free_ram_mb               | 130528                                   |
| host_ip                   | 10.12.8.13                               |
| hypervisor_hostname       | f2lcompute1.actinver.com.mx              |
| hypervisor_type           | QEMU                                     |
| hypervisor_version        | 2009000                                  |
| id                        | 2                                        |
| local_gb                  | 49                                       |
| local_gb_used             | 0                                        |
| memory_mb                 | 131040                                   |
| memory_mb_used            | 512                                      |
| running_vms               | 0                                        |
| service_disabled_reason   | None                                     |
| service_host              | f2lcompute1.actinver.com.mx              |
| service_id                | 22                                       |
| state                     | up                                       |
| status                    | enabled                                  |
| vcpus                     | 32                                       |
| vcpus_used                | 0                                        |
+---------------------------+------------------------------------------+




[root@f2lctr01 ~(keystone_admin)]# nova hypervisor-show f2lcompute2.actinver.com.mx
+---------------------------+------------------------------------------+
| Property                  | Value                                    |
+---------------------------+------------------------------------------+
| cpu_info_arch             | x86_64                                   |
| cpu_info_features         | ["pge", "avx", "xsaveopt", "clflush",    |
|                           | "sep", "syscall", "tsc-deadline",        |
|                           | "dtes64", "msr", "xsave", "vmx", "xtpr", |
|                           | "cmov", "pcid", "est", "pat", "monitor", |
|                           | "smx", "pbe", "lm", "tsc", "nx", "fxsr", |
|                           | "tm", "sse4.1", "pae", "sse4.2",         |
|                           | "pclmuldq", "acpi", "vme", "mmx",        |
|                           | "osxsave", "cx8", "mce", "de", "rdtscp", |
|                           | "ht", "dca", "lahf_lm", "pdcm", "mca",   |
|                           | "pdpe1gb", "apic", "sse", "pse", "ds",   |
|                           | "invtsc", "pni", "tm2", "aes", "sse2",   |
|                           | "ss", "ds_cpl", "arat", "ssse3", "fpu",  |
|                           | "cx16", "pse36", "mtrr", "popcnt",       |
|                           | "x2apic"]                                |
| cpu_info_model            | SandyBridge                              |
| cpu_info_topology_cells   | 2                                        |
| cpu_info_topology_cores   | 8                                        |
| cpu_info_topology_sockets | 1                                        |
| cpu_info_topology_threads | 2                                        |
| cpu_info_vendor           | Intel                                    |
| current_workload          | 0                                        |
| disk_available_least      | 47                                       |
| free_disk_gb              | 49                                       |
| free_ram_mb               | 130529                                   |
| host_ip                   | 10.12.8.14                               |
| hypervisor_hostname       | f2lcompute2.actinver.com.mx              |
| hypervisor_type           | QEMU                                     |
| hypervisor_version        | 2009000                                  |
| id                        | 3                                        |
| local_gb                  | 49                                       |
| local_gb_used             | 0                                        |
| memory_mb                 | 131041                                   |
| memory_mb_used            | 512                                      |
| running_vms               | 0                                        |
| service_disabled_reason   | None                                     |
| service_host              | f2lcompute2.actinver.com.mx              |
| service_id                | 23                                       |
| state                     | up                                       |
| status                    | enabled                                  |
| vcpus                     | 32                                       |
| vcpus_used                | 0                                        |
+---------------------------+------------------------------------------+



[root@f2lctr01 ~(keystone_admin)]# nova hypervisor-show f2lcompute3.actinver.com.mx
+---------------------------+------------------------------------------+
| Property                  | Value                                    |
+---------------------------+------------------------------------------+
| cpu_info_arch             | x86_64                                   |
| cpu_info_features         | ["pge", "avx", "xsaveopt", "clflush",    |
|                           | "sep", "syscall", "tsc-deadline",        |
|                           | "dtes64", "msr", "xsave", "vmx", "xtpr", |
|                           | "cmov", "pcid", "est", "pat", "monitor", |
|                           | "smx", "pbe", "lm", "tsc", "nx", "fxsr", |
|                           | "tm", "sse4.1", "pae", "sse4.2",         |
|                           | "pclmuldq", "acpi", "vme", "mmx",        |
|                           | "osxsave", "cx8", "mce", "de", "rdtscp", |
|                           | "ht", "dca", "lahf_lm", "pdcm", "mca",   |
|                           | "pdpe1gb", "apic", "sse", "pse", "ds",   |
|                           | "invtsc", "pni", "tm2", "aes", "sse2",   |
|                           | "ss", "ds_cpl", "arat", "ssse3", "fpu",  |
|                           | "cx16", "pse36", "mtrr", "popcnt",       |
|                           | "x2apic"]                                |
| cpu_info_model            | SandyBridge                              |
| cpu_info_topology_cells   | 2                                        |
| cpu_info_topology_cores   | 8                                        |
| cpu_info_topology_sockets | 1                                        |
| cpu_info_topology_threads | 2                                        |
| cpu_info_vendor           | Intel                                    |
| current_workload          | 0                                        |
| disk_available_least      | 47                                       |
| free_disk_gb              | 49                                       |
| free_ram_mb               | 130528                                   |
| host_ip                   | 10.12.8.15                               |
| hypervisor_hostname       | f2lcompute3.actinver.com.mx              |
| hypervisor_type           | QEMU                                     |
| hypervisor_version        | 2009000                                  |
| id                        | 1                                        |
| local_gb                  | 49                                       |
| local_gb_used             | 0                                        |
| memory_mb                 | 131040                                   |
| memory_mb_used            | 512                                      |
| running_vms               | 0                                        |
| service_disabled_reason   | None                                     |
| service_host              | f2lcompute3.actinver.com.mx              |
| service_id                | 21                                       |
| state                     | up                                       |
| status                    | enabled                                  |
| vcpus                     | 32                                       |
| vcpus_used                | 0                                        |
+---------------------------+------------------------------------------+




[root@f2lctr01 network-scripts]# ls
ifcfg-br-ex          ifcfg-enp12s0f6  ifdown-isdn      ifdown-tunnel  ifup-ovs     ifup-TeamPort
ifcfg-eno1.706       ifcfg-enp12s0f7  ifdown-ovs       ifup           ifup-plip    ifup-tunnel
ifcfg-enp0s29u1u1u5  ifcfg-lo         ifdown-post      ifup-aliases   ifup-plusb   ifup-wireless
ifcfg-enp12s0f1      ifdown           ifdown-ppp       ifup-bnep      ifup-post    init.ipv6-global
ifcfg-enp12s0f2.506  ifdown-bnep      ifdown-routes    ifup-eth       ifup-ppp     network-functions
ifcfg-enp12s0f3      ifdown-eth       ifdown-sit       ifup-ippp      ifup-routes  network-functions-ipv6
ifcfg-enp12s0f4      ifdown-ippp      ifdown-Team      ifup-ipv6      ifup-sit
ifcfg-enp12s0f5      ifdown-ipv6      ifdown-TeamPort  ifup-isdn      ifup-Team
[root@f2lctr01 network-scripts]# 
[root@f2lctr01 network-scripts]# 
[root@f2lctr01 network-scripts]# cat ifcfg-br-ex
DEFROUTE=yes
ONBOOT=yes
IPADDR=10.12.8.11
PREFIX=24
GATEWAY=10.12.8.254
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=static
TYPE=OVSBridge
[root@f2lctr01 network-scripts]# 
[root@f2lctr01 network-scripts]# 
[root@f2lctr01 network-scripts]# cat ifcfg-enp12s0f2.506
DEVICE=enp12s0f2.506
NAME=enp12s0f2.506
DEVICETYPE=ovs
TYPE=OVSPort
OVS_BRIDGE=br-ex
ONBOOT=yes
BOOTPROTO=none
VLAN=yes

[root@f2lctr01 network-scripts]# ip r s
default via 10.12.8.254 dev br-ex 
10.10.205.0/24 dev eno1.706 proto kernel scope link src 10.10.205.19 
10.12.8.0/24 dev br-ex proto kernel scope link src 10.12.8.11 
169.254.0.0/16 dev eno1.706 scope link metric 1017 
169.254.0.0/16 dev enp12s0f2.506 scope link metric 1021 
169.254.0.0/16 dev br-ex scope link metric 1022











[root@f2lctr02 network-scripts]# ls ; cat ifcfg-br-ex
ifcfg-br-ex          ifcfg-enp12s0f4  ifdown-bnep  ifdown-post      ifdown-tunnel  ifup-ipv6   ifup-ppp       ifup-wireless
ifcfg-eno1.706       ifcfg-enp12s0f5  ifdown-eth   ifdown-ppp       ifup           ifup-isdn   ifup-routes    init.ipv6-global
ifcfg-enp0s29u1u1u5  ifcfg-enp12s0f6  ifdown-ippp  ifdown-routes    ifup-aliases   ifup-ovs    ifup-sit       network-functions
ifcfg-enp12s0f1      ifcfg-enp12s0f7  ifdown-ipv6  ifdown-sit       ifup-bnep      ifup-plip   ifup-Team      network-functions-ipv6
ifcfg-enp12s0f2.506  ifcfg-lo         ifdown-isdn  ifdown-Team      ifup-eth       ifup-plusb  ifup-TeamPort
ifcfg-enp12s0f3      ifdown           ifdown-ovs   ifdown-TeamPort  ifup-ippp      ifup-post   ifup-tunnel
DEFROUTE=yes
ONBOOT=yes
IPADDR=10.12.8.12
PREFIX=24
GATEWAY=10.12.8.254
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=static
TYPE=OVSBridge

[root@f2lctr02 network-scripts]# cat ifcfg-enp12s0f2.506
DEVICE=enp12s0f2.506
NAME=enp12s0f2.506
DEVICETYPE=ovs
TYPE=OVSPort
OVS_BRIDGE=br-ex
ONBOOT=yes
BOOTPROTO=none
VLAN=yes

[root@f2lctr02 network-scripts]# ip r s
default via 10.12.8.254 dev br-ex 
10.10.205.0/24 dev eno1.706 proto kernel scope link src 10.10.205.20 
10.12.8.0/24 dev br-ex proto kernel scope link src 10.12.8.12 
169.254.0.0/16 dev eno1.706 scope link metric 1022 
169.254.0.0/16 dev enp12s0f2.506 scope link metric 1026 
169.254.0.0/16 dev br-ex scope link metric 1027 
[root@f2lctr02 network-scripts]# 








[root@f2lcompute1 network-scripts]# ls 
ifcfg-br-ex          ifcfg-enp12s0f4  ifdown-bnep  ifdown-ovs     ifdown-TeamPort  ifup-ib    ifup-plusb   ifup-TeamPort
ifcfg-eno1.706       ifcfg-enp12s0f5  ifdown-eth   ifdown-post    ifdown-tunnel    ifup-ippp  ifup-post    ifup-tunnel
ifcfg-enp0s29u1u1u5  ifcfg-enp12s0f6  ifdown-ib    ifdown-ppp     ifup             ifup-ipv6  ifup-ppp     ifup-wireless
ifcfg-enp12s0f1      ifcfg-enp12s0f7  ifdown-ippp  ifdown-routes  ifup-aliases     ifup-isdn  ifup-routes  init.ipv6-global
ifcfg-enp12s0f2.506  ifcfg-lo         ifdown-ipv6  ifdown-sit     ifup-bnep        ifup-ovs   ifup-sit     network-functions
ifcfg-enp12s0f3      ifdown           ifdown-isdn  ifdown-Team    ifup-eth         ifup-plip  ifup-Team    network-functions-ipv6
[root@f2lcompute1 network-scripts]# cat ifcfg-br-ex 
DEFROUTE=yes
ONBOOT=yes
IPADDR=10.12.8.13
PREFIX=24
GATEWAY=10.12.8.254
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=static
TYPE=OVSBridge
[root@f2lcompute1 network-scripts]# 
[root@f2lcompute1 network-scripts]# 
[root@f2lcompute1 network-scripts]# 
[root@f2lcompute1 network-scripts]# cat ifcfg-br-ex
DEFROUTE=yes
ONBOOT=yes
IPADDR=10.12.8.13
PREFIX=24
GATEWAY=10.12.8.254
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=static
TYPE=OVSBridge


[root@f2lcompute1 network-scripts]# ip r s
default via 10.12.8.254 dev br-ex 
10.10.205.0/24 dev eno1.706 proto kernel scope link src 10.10.205.21 
10.12.8.0/24 dev br-ex proto kernel scope link src 10.12.8.13 
169.254.0.0/16 dev enp0s29u1u1u5 scope link metric 1010 
169.254.0.0/16 dev eno1.706 scope link metric 1031 
169.254.0.0/16 dev enp12s0f2.506 scope link metric 1035 
169.254.0.0/16 dev br-ex scope link metric 1036 
169.254.95.0/24 dev enp0s29u1u1u5 proto kernel scope link src 169.254.95.120 











[root@f2lcompute2 network-scripts]# ls
ifcfg-br-ex          ifcfg-lo     ifdown-ppp       ifup-ib      ifup-sit
ifcfg-eno1.706       ifdown       ifdown-routes    ifup-ippp    ifup-Team
ifcfg-enp0s29u1u1u5  ifdown-bnep  ifdown-sit       ifup-ipv6    ifup-TeamPort
ifcfg-enp12s0f1      ifdown-eth   ifdown-Team      ifup-isdn    ifup-tunnel
ifcfg-enp12s0f2.506  ifdown-ib    ifdown-TeamPort  ifup-ovs     ifup-wireless
ifcfg-enp12s0f3      ifdown-ippp  ifdown-tunnel    ifup-plip    init.ipv6-global
ifcfg-enp12s0f4      ifdown-ipv6  ifup             ifup-plusb   network-functions
ifcfg-enp12s0f5      ifdown-isdn  ifup-aliases     ifup-post    network-functions-ipv6
ifcfg-enp12s0f6      ifdown-ovs   ifup-bnep        ifup-ppp
ifcfg-enp12s0f7      ifdown-post  ifup-eth         ifup-routes
[root@f2lcompute2 network-scripts]# cat ifcfg-br-ex 
DEFROUTE=yes
ONBOOT=yes
IPADDR=10.12.8.14
PREFIX=24
GATEWAY=10.12.8.254
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=static
TYPE=OVSBridge
[root@f2lcompute2 network-scripts]# 
[root@f2lcompute2 network-scripts]# 
[root@f2lcompute2 network-scripts]# cat ifcfg-enp12s0f2.506
DEVICE=enp12s0f2.506
NAME=enp12s0f2.506
DEVICETYPE=ovs
TYPE=OVSPort
OVS_BRIDGE=br-ex
ONBOOT=yes
BOOTPROTO=none
VLAN=yes

[root@f2lcompute2 network-scripts]# ip r s
default via 10.12.8.254 dev br-ex 
10.10.205.0/24 dev eno1.706 proto kernel scope link src 10.10.205.23 
10.12.8.0/24 dev br-ex proto kernel scope link src 10.12.8.14 
169.254.0.0/16 dev eno1.706 scope link metric 1016 
169.254.0.0/16 dev enp12s0f2.506 scope link metric 1020 
169.254.0.0/16 dev br-ex scope link metric 1021 






[root@f2lcompute3 network-scripts]# ls
ifcfg-br-ex          ifcfg-lo     ifdown-ppp       ifup-ib      ifup-sit
ifcfg-eno1.706       ifdown       ifdown-routes    ifup-ippp    ifup-Team
ifcfg-enp0s29u1u1u5  ifdown-bnep  ifdown-sit       ifup-ipv6    ifup-TeamPort
ifcfg-enp12s0f1      ifdown-eth   ifdown-Team      ifup-isdn    ifup-tunnel
ifcfg-enp12s0f2.506  ifdown-ib    ifdown-TeamPort  ifup-ovs     ifup-wireless
ifcfg-enp12s0f3      ifdown-ippp  ifdown-tunnel    ifup-plip    init.ipv6-global
ifcfg-enp12s0f4      ifdown-ipv6  ifup             ifup-plusb   network-functions
ifcfg-enp12s0f5      ifdown-isdn  ifup-aliases     ifup-post    network-functions-ipv6
ifcfg-enp12s0f6      ifdown-ovs   ifup-bnep        ifup-ppp
ifcfg-enp12s0f7      ifdown-post  ifup-eth         ifup-routes
[root@f2lcompute3 network-scripts]# 
[root@f2lcompute3 network-scripts]# 
[root@f2lcompute3 network-scripts]# cat ifcfg-br-ex 
DEFROUTE=yes
ONBOOT=yes
IPADDR=10.12.8.15
PREFIX=24
GATEWAY=10.12.8.254
DEVICE=br-ex
NAME=br-ex
DEVICETYPE=ovs
OVSBOOTPROTO=static
TYPE=OVSBridge
[root@f2lcompute3 network-scripts]# 
[root@f2lcompute3 network-scripts]# 
[root@f2lcompute3 network-scripts]# cat ifcfg-enp12s0f2.506 
DEVICE=enp12s0f2.506
NAME=enp12s0f2.506
DEVICETYPE=ovs
TYPE=OVSPort
OVS_BRIDGE=br-ex
ONBOOT=yes
BOOTPROTO=none
VLAN=yes


[root@f2lcompute3 network-scripts]# ip r s
default via 10.12.8.254 dev br-ex 
10.10.205.0/24 dev eno1.706 proto kernel scope link src 10.10.205.24 
10.12.8.0/24 dev br-ex proto kernel scope link src 10.12.8.15 
169.254.0.0/16 dev eno1.706 scope link metric 1016 
169.254.0.0/16 dev enp12s0f2.506 scope link metric 1020 
169.254.0.0/16 dev br-ex scope link metric 1021 



== 4 .- Revisando DB.

[root@f2lctr01 ~(keystone_admin)]# mysql
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 531
Server version: 5.5.42-MariaDB-wsrep MariaDB Server, wsrep_25.11.r4026

Copyright (c) 2000, 2017, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> SELECT User, Host, Password FROM mysql.user;
+----------------+-----------+-------------------------------------------+
| User           | Host      | Password                                  |
+----------------+-----------+-------------------------------------------+
| root           | localhost | *7836275A3B7A3E6BABB3410287E022F4617B829D |
| keystone_admin | %         | *9BCFF9D969076DC60C2F02357F4EE96D967F632F |
| keystone_admin | 127.0.0.1 | *9BCFF9D969076DC60C2F02357F4EE96D967F632F |
| gnocchi        | %         | *C2C100AA8F6E6C19BF2B7134D3F4E96AC6F1E787 |
| glance         | %         | *DDF23C32F92A55468AEAC4B43295D98160B613B3 |
| nova           | %         | *6B42410F859FC02B52BEF6A8646B07F23B4FAF42 |
| nova_api       | %         | *6B42410F859FC02B52BEF6A8646B07F23B4FAF42 |
| cinder         | %         | *7EDF1D69BD259BD5358E63B501289414A68695BC |
| neutron        | %         | *2BDCAD057E1A2B6730A90B466C093A09DFB862F8 |
| heat           | %         | *03B9EEFDC12049A45E6564CE18EB437230BDFBA7 |
+----------------+-----------+-------------------------------------------+
10 rows in set (0.00 sec)

MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| cinder             |
| glance             |
| gnocchi            |
| heat               |
| keystone           |
| mysql              |
| neutron            |
| nova               |
| nova_api           |
| performance_schema |
| test               |
+--------------------+
12 rows in set (0.01 sec)

MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> 
MariaDB [(none)]> use nova;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> SHOW TABLES;
+--------------------------------------------+
| Tables_in_nova                             |
+--------------------------------------------+
| agent_builds                               |
| aggregate_hosts                            |
| aggregate_metadata                         |
| aggregates                                 |
| allocations                                |
| block_device_mapping                       |
| bw_usage_cache                             |
| cells                                      |
| certificates                               |
| compute_nodes                              |
| console_auth_tokens                        |
| console_pools                              |
| consoles                                   |
| dns_domains                                |
| fixed_ips                                  |
| floating_ips                               |
| instance_actions                           |
| instance_actions_events                    |
| instance_extra                             |
| instance_faults                            |
| instance_group_member                      |
| instance_group_policy                      |
| instance_groups                            |
| instance_id_mappings                       |
| instance_info_caches                       |
| instance_metadata                          |
| instance_system_metadata                   |
| instance_type_extra_specs                  |
| instance_type_projects                     |
| instance_types                             |
| instances                                  |
| inventories                                |
| key_pairs                                  |
| migrate_version                            |
| migrations                                 |
| networks                                   |
| pci_devices                                |
| project_user_quotas                        |
| provider_fw_rules                          |
| quota_classes                              |
| quota_usages                               |
| quotas                                     |
| reservations                               |
| resource_provider_aggregates               |
| resource_providers                         |
| s3_images                                  |
| security_group_default_rules               |
| security_group_instance_association        |
| security_group_rules                       |
| security_groups                            |
| services                                   |
| shadow_agent_builds                        |
| shadow_aggregate_hosts                     |
| shadow_aggregate_metadata                  |
| shadow_aggregates                          |
| shadow_block_device_mapping                |
| shadow_bw_usage_cache                      |
| shadow_cells                               |
| shadow_certificates                        |
| shadow_compute_nodes                       |
| shadow_console_pools                       |
| shadow_consoles                            |
| shadow_dns_domains                         |
| shadow_fixed_ips                           |
| shadow_floating_ips                        |
| shadow_instance_actions                    |
| shadow_instance_actions_events             |
| shadow_instance_extra                      |
| shadow_instance_faults                     |
| shadow_instance_group_member               |
| shadow_instance_group_policy               |
| shadow_instance_groups                     |
| shadow_instance_id_mappings                |
| shadow_instance_info_caches                |
| shadow_instance_metadata                   |
| shadow_instance_system_metadata            |
| shadow_instance_type_extra_specs           |
| shadow_instance_type_projects              |
| shadow_instance_types                      |
| shadow_instances                           |
| shadow_key_pairs                           |
| shadow_migrate_version                     |
| shadow_migrations                          |
| shadow_networks                            |
| shadow_pci_devices                         |
| shadow_project_user_quotas                 |
| shadow_provider_fw_rules                   |
| shadow_quota_classes                       |
| shadow_quota_usages                        |
| shadow_quotas                              |
| shadow_reservations                        |
| shadow_s3_images                           |
| shadow_security_group_default_rules        |
| shadow_security_group_instance_association |
| shadow_security_group_rules                |
| shadow_security_groups                     |
| shadow_services                            |
| shadow_snapshot_id_mappings                |
| shadow_snapshots                           |
| shadow_task_log                            |
| shadow_virtual_interfaces                  |
| shadow_volume_id_mappings                  |
| shadow_volume_usage_cache                  |
| snapshot_id_mappings                       |
| snapshots                                  |
| tags                                       |
| task_log                                   |
| virtual_interfaces                         |
| volume_id_mappings                         |
| volume_usage_cache                         |
+--------------------------------------------+
110 rows in set (0.00 sec)

MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> SHOW TABLES WHERE Tables_in_nova LIKE 'instance%';
+---------------------------+
| Tables_in_nova            |
+---------------------------+
| instance_actions          |
| instance_actions_events   |
| instance_extra            |
| instance_faults           |
| instance_group_member     |
| instance_group_policy     |
| instance_groups           |
| instance_id_mappings      |
| instance_info_caches      |
| instance_metadata         |
| instance_system_metadata  |
| instance_type_extra_specs |
| instance_type_projects    |
| instance_types            |
| instances                 |
+---------------------------+
15 rows in set (0.00 sec)

MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> describe instances;
+--------------------------+-----------------------+------+-----+---------+----------------+
| Field                    | Type                  | Null | Key | Default | Extra          |
+--------------------------+-----------------------+------+-----+---------+----------------+
| created_at               | datetime              | YES  |     | NULL    |                |
| updated_at               | datetime              | YES  |     | NULL    |                |
| deleted_at               | datetime              | YES  |     | NULL    |                |
| id                       | int(11)               | NO   | PRI | NULL    | auto_increment |
| internal_id              | int(11)               | YES  |     | NULL    |                |
| user_id                  | varchar(255)          | YES  |     | NULL    |                |
| project_id               | varchar(255)          | YES  | MUL | NULL    |                |
| image_ref                | varchar(255)          | YES  |     | NULL    |                |
| kernel_id                | varchar(255)          | YES  |     | NULL    |                |
| ramdisk_id               | varchar(255)          | YES  |     | NULL    |                |
| launch_index             | int(11)               | YES  |     | NULL    |                |
| key_name                 | varchar(255)          | YES  |     | NULL    |                |
| key_data                 | mediumtext            | YES  |     | NULL    |                |
| power_state              | int(11)               | YES  |     | NULL    |                |
| vm_state                 | varchar(255)          | YES  |     | NULL    |                |
| memory_mb                | int(11)               | YES  |     | NULL    |                |
| vcpus                    | int(11)               | YES  |     | NULL    |                |
| hostname                 | varchar(255)          | YES  |     | NULL    |                |
| host                     | varchar(255)          | YES  | MUL | NULL    |                |
| user_data                | mediumtext            | YES  |     | NULL    |                |
| reservation_id           | varchar(255)          | YES  | MUL | NULL    |                |
| scheduled_at             | datetime              | YES  |     | NULL    |                |
| launched_at              | datetime              | YES  |     | NULL    |                |
| terminated_at            | datetime              | YES  | MUL | NULL    |                |
| display_name             | varchar(255)          | YES  |     | NULL    |                |
| display_description      | varchar(255)          | YES  |     | NULL    |                |
| availability_zone        | varchar(255)          | YES  |     | NULL    |                |
| locked                   | tinyint(1)            | YES  |     | NULL    |                |
| os_type                  | varchar(255)          | YES  |     | NULL    |                |
| launched_on              | mediumtext            | YES  |     | NULL    |                |
| instance_type_id         | int(11)               | YES  |     | NULL    |                |
| vm_mode                  | varchar(255)          | YES  |     | NULL    |                |
| uuid                     | varchar(36)           | NO   | UNI | NULL    |                |
| architecture             | varchar(255)          | YES  |     | NULL    |                |
| root_device_name         | varchar(255)          | YES  |     | NULL    |                |
| access_ip_v4             | varchar(39)           | YES  |     | NULL    |                |
| access_ip_v6             | varchar(39)           | YES  |     | NULL    |                |
| config_drive             | varchar(255)          | YES  |     | NULL    |                |
| task_state               | varchar(255)          | YES  | MUL | NULL    |                |
| default_ephemeral_device | varchar(255)          | YES  |     | NULL    |                |
| default_swap_device      | varchar(255)          | YES  |     | NULL    |                |
| progress                 | int(11)               | YES  |     | NULL    |                |
| auto_disk_config         | tinyint(1)            | YES  |     | NULL    |                |
| shutdown_terminate       | tinyint(1)            | YES  |     | NULL    |                |
| disable_terminate        | tinyint(1)            | YES  |     | NULL    |                |
| root_gb                  | int(11)               | YES  |     | NULL    |                |
| ephemeral_gb             | int(11)               | YES  |     | NULL    |                |
| cell_name                | varchar(255)          | YES  |     | NULL    |                |
| node                     | varchar(255)          | YES  |     | NULL    |                |
| deleted                  | int(11)               | YES  | MUL | NULL    |                |
| locked_by                | enum('owner','admin') | YES  |     | NULL    |                |
| cleaned                  | int(11)               | YES  |     | NULL    |                |
| ephemeral_key_uuid       | varchar(36)           | YES  |     | NULL    |                |
+--------------------------+-----------------------+------+-----+---------+----------------+
53 rows in set (0.00 sec)

MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> 
MariaDB [nova]> exit
Bye


== 5 .- Revision de keystone

[root@f2lctr01 ~(keystone_admin)]# cat keystonerc_admin 
unset OS_SERVICE_TOKEN
    export OS_USERNAME=admin
    export OS_PASSWORD=Actinver01
    export OS_AUTH_URL=http://10.12.8.11:5000/v2.0
    export PS1='[\u@\h \W(keystone_admin)]\$ '
    
export OS_TENANT_NAME=admin
export OS_REGION_NAME=RegionOne
    [root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# openstack user list
+----------------------------------+------------+
| ID                               | Name       |
+----------------------------------+------------+
| e49cba1a5785469298c4966dd3ae8925 | admin      |
| 14eaf1419fe8490f935ebdc5e8563118 | neutron    |
| d2c1ebd5d88a44d8867677ac343ca0a1 | heat       |
| 3ae8b5b6827b4f5f89f8e4436aa6d84d | gnocchi    |
| f9779d9148614f8da657767fbf14308b | aodh       |
| ab89e750fd424abf898b4aef6ec33b4a | nova       |
| 8913e8dae1cc49ed84489e39b295f5ea | glance     |
| cb4199fc12764d6a8dafc10d3e4fb172 | ceilometer |
| 014141599b27405eaf257fef6ca68bdd | cinder     |
| 778789bdb9ec49868dae2c252be7e850 | heat-cfn   |
| 91ccd2aede254a25b3f0b04176d24533 | swift      |
+----------------------------------+------------+
[root@f2lctr01 ~(keystone_admin)]# openstack user show admin
+----------+----------------------------------+
| Field    | Value                            |
+----------+----------------------------------+
| email    | root@localhost                   |
| enabled  | True                             |
| id       | e49cba1a5785469298c4966dd3ae8925 |
| name     | admin                            |
| username | admin                            |
+----------+----------------------------------+
[root@f2lctr01 ~(keystone_admin)]# openstack endpoint list
+----------------------------------+-----------+--------------+----------------+
| ID                               | Region    | Service Name | Service Type   |
+----------------------------------+-----------+--------------+----------------+
| 0c21505a10ca4f4c9aab286b50b670f9 | RegionOne | cinderv3     | volumev3       |
| a080fa262b084427bf4339693582346b | RegionOne | ceilometer   | metering       |
| bad71b8300b24435acf77af36bd032f0 | RegionOne | aodh         | alarming       |
| 109550a732184ee2b91d334480c099af | RegionOne | keystone     | identity       |
| d16db93a2f86494fa2cbb2864dd59e3a | RegionOne | nova         | compute        |
| 7562dfb518104082920f8f645a80a73f | RegionOne | heat         | orchestration  |
| 905fdd8936bc42e38003ce5b058a0d92 | RegionOne | heat-cfn     | cloudformation |
| 04fea0388493406394f38571bd3874ff | RegionOne | swift        | object-store   |
| 7375cc1204b44988bb93d875d914ffba | RegionOne | cinder       | volume         |
| 5ace8cc258ad46058934d50f022abb9f | RegionOne | glance       | image          |
| 455d07d041734a7cb732251e764c2945 | RegionOne | neutron      | network        |
| d1045e9fe7914e97bb60d4d0e3a02dac | RegionOne | cinderv2     | volumev2       |
| 1c7f04859c7546e7b74096e3593370d2 | RegionOne | gnocchi      | metric         |
+----------------------------------+-----------+--------------+----------------+
[root@f2lctr01 ~(keystone_admin)]# openstack endpoint show 109550a732184ee2b91d334480c099af
+--------------+----------------------------------+
| Field        | Value                            |
+--------------+----------------------------------+
| adminurl     | http://10.12.8.11:35357/v2.0     |
| enabled      | True                             |
| id           | 109550a732184ee2b91d334480c099af |
| internalurl  | http://10.12.8.11:5000/v2.0      |
| publicurl    | http://10.12.8.11:5000/v2.0      |
| region       | RegionOne                        |
| service_id   | 69d7dd4a183f4181b0d5b6a051574951 |
| service_name | keystone                         |
| service_type | identity                         |
+--------------+----------------------------------+


== 6 .- Manage Projects and Users Lab

[root@f2lctr01 ~(keystone_admin)]# openstack project list
+----------------------------------+----------+
| ID                               | Name     |
+----------------------------------+----------+
| 4cb8ec605eb64fd38a7f8aa4eb54f9d3 | admin    |
[root@f2lctr01 ~(keystone_admin)]# openstack project create --description "Proyecto de prueba Actinver1" Proyecto1
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Proyecto de prueba Actinver1     |
| enabled     | True                             |
| id          | 14fac5cc8cfe4453b6e0a3f03e4a9766 |
| name        | Proyecto1                        |
+-------------+----------------------------------+
[root@f2lctr01 ~(keystone_admin)]# openstack project show Proyecto1
+-------------+----------------------------------+
| Field       | Value                            |
+-------------+----------------------------------+
| description | Proyecto de prueba Actinver1     |
| enabled     | True                             |
| id          | 14fac5cc8cfe4453b6e0a3f03e4a9766 |
| name        | Proyecto1                        |
| properties  |                                  |
+-------------+----------------------------------+
[root@f2lctr01 ~(keystone_admin)]# openstack project list
+----------------------------------+-----------+
| ID                               | Name      |
+----------------------------------+-----------+
| 14fac5cc8cfe4453b6e0a3f03e4a9766 | Proyecto1 |
| 4192cb8ea3224a70aa7429a0ff30f536 | services  |
| 4cb8ec605eb64fd38a7f8aa4eb54f9d3 | admin     |
+----------------------------------+-----------+
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# openstack quota show Proyecto1
+----------------------+----------------------------------+
| Field                | Value                            |
+----------------------+----------------------------------+
| backup_gigabytes     | 1000                             |
| backups              | 10                               |
| cores                | 20                               |
| fixed-ips            | -1                               |
| floating-ips         | 50                               |
| gigabytes            | 1000                             |
| gigabytes_iscsi      | -1                               |
| graph                | -1                               |
| healthmonitor        | -1                               |
| injected-file-size   | 10240                            |
| injected-files       | 5                                |
| injected-path-size   | 255                              |
| instances            | 10                               |
| key-pairs            | 100                              |
| l7policy             | -1                               |
| listener             | -1                               |
| loadbalancer         | 10                               |
| members              | -1                               |
| networks             | 10                               |
| per_volume_gigabytes | -1                               |
| pool                 | 10                               |
| ports                | 50                               |
| project              | 14fac5cc8cfe4453b6e0a3f03e4a9766 |
| properties           | 128                              |
| ram                  | 51200                            |
| rbac-policies        | 10                               |
| routers              | 10                               |
| secgroup-rules       | 100                              |
| secgroups            | 10                               |
| server-group-members | 10                               |
| server-groups        | 10                               |
| snapshots            | 10                               |
| snapshots_iscsi      | -1                               |
| subnetpools          | -1                               |
| subnets              | 10                               |
| volumes              | 10                               |
| volumes_iscsi        | -1                               |
+----------------------+----------------------------------+
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# ##################################
[root@f2lctr01 ~(keystone_admin)]# #
[root@f2lctr01 ~(keystone_admin)]# # Creando Usuarios
[root@f2lctr01 ~(keystone_admin)]# #
[root@f2lctr01 ~(keystone_admin)]# ##################################
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# openstack user list
+----------------------------------+------------+
| ID                               | Name       |
+----------------------------------+------------+
| e49cba1a5785469298c4966dd3ae8925 | admin      |
| 14eaf1419fe8490f935ebdc5e8563118 | neutron    |
| d2c1ebd5d88a44d8867677ac343ca0a1 | heat       |
| 3ae8b5b6827b4f5f89f8e4436aa6d84d | gnocchi    |
| f9779d9148614f8da657767fbf14308b | aodh       |
| ab89e750fd424abf898b4aef6ec33b4a | nova       |
| 8913e8dae1cc49ed84489e39b295f5ea | glance     |
| cb4199fc12764d6a8dafc10d3e4fb172 | ceilometer |
| 014141599b27405eaf257fef6ca68bdd | cinder     |
| 778789bdb9ec49868dae2c252be7e850 | heat-cfn   |
| 91ccd2aede254a25b3f0b04176d24533 | swift      |
+----------------------------------+------------+
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# 
[root@f2lctr01 ~(keystone_admin)]# #openstack user create --password r3dh4t1! --email root@localhost --project Project2 user2
[root@f2lctr01 ~(keystone_admin)]# openstack user create --password Actinver01 --email mpinedam@redhat.com --project Proyecto1 actinver
+------------+----------------------------------+
| Field      | Value                            |
+------------+----------------------------------+
| email      | mpinedam@redhat.com              |
| enabled    | True                             |
| id         | ae540b5b2907471982e89fefd992c5c7 |
| name       | actinver                         |
| project_id | 14fac5cc8cfe4453b6e0a3f03e4a9766 |
| username   | actinver                         |
+------------+----------------------------------+
[root@f2lctr01 ~(keystone_admin)]# 


== 7 .- Revisando Neutron.




















issues

flushing device ethernet
ip addr flush dev enp12s0f2.406
flushing routing
echo 1  > /proc/sys/net/ipv4/flush













